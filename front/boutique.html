<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleur de Pau</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Raleway:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <style>
       /* Styles g√©n√©raux */
body {
    font-family: 'Raleway', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

header {
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-content {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
}

.logo {
    font-family: 'Pacifico', cursive;
    font-size: 1.8rem;
    color: #444;
    margin: 10px 0;
}

/* Menu */
nav ul {
    list-style: none;
    display: flex;
    justify-content: flex-end;
    padding: 0;
    margin: 0;
}

nav ul li {
    margin: 0 1rem;
}

nav ul li a {
    text-decoration: none;
    color: #555;
    font-weight: bold;
    transition: color 0.3s;
}

nav ul li a:hover {
    color: #d85c5c;
}

/* Ic√¥nes align√©es √† l'horizontale sur la droite */
.header-icons {
    display: flex;
    justify-content: flex-end;
    gap: 20px;
    position: absolute;
    top: 10px;
    right: 20px;
    align-items: center;
}

.header-icons a,
.header-icons i {
    font-size: 24px;
    color: #333;
    cursor: pointer;
}

/* Styles du conteneur de produits */
.produits-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 produits par ligne par d√©faut */
    gap: 20px;
    padding: 2rem;
    max-width: 1200px;
    margin: auto;
}

/* Carte Produit */
.produit {
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    padding: 1rem;
    text-align: center;
    max-width: 300px;
    width: 100%;
    min-height: 420px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.3s, box-shadow 0.3s ease;
}

.produit:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

/* Image du produit */
.produit img {
    max-width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    transition: transform 0.3s ease;
}

.produit img:hover {
    transform: scale(1.05);
}

.produit h3 {
    font-size: 1.2rem;
    color: #333;
    margin: 0.5rem 0;
}

.produit p {
    color: #666;
    font-size: 0.9rem;
}

.produit .prix {
    font-size: 1.1rem;
    font-weight: bold;
    color: #d85c5c;
}

/* Bouton Ajout Panier */
button.add-to-cart {
    background-color: #5e380c;
    color: #fff;
    border: none;
    padding: 0.8rem 1.2rem; /* Augmentation de la taille du bouton */
    font-size: 1.1rem; /* Augmenter l√©g√®rement la taille du texte */
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s ease, box-shadow 0.2s ease;
}

button.add-to-cart:hover {
    background-color: #a44b4b;
    transform: scale(1.05); /* L√©g√®re augmentation de la taille au survol */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Ombre suppl√©mentaire au survol */
}

button.add-to-cart:active {
    transform: scale(1); /* R√©duit la taille lors du clic pour un effet de pression */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); /* Ombre plus petite quand cliqu√© */
}

/* S√©lecteur de couleur */
.produit select {
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background: #f9f9f9;
    font-size: 1rem;
}

/* Fond de la modal */
.modal {
    display: none; /* Cach√©e par d√©faut */
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
}

/* Image agrandie */
.modal-content {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease-in-out;
}

/* Bouton pour fermer */
.close {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 30px;
    color: white;
    cursor: pointer;
}

footer {
    text-align: center;
    padding: 1rem;
    background-color: #333;
    color: #fff;
}

/* Styles Responsives */

/* Mobile */
@media (max-width: 480px) {
    .produits-grid {
        grid-template-columns: 1fr; /* 1 produit par ligne */
        gap: 15px;
        padding: 1rem;
    }

    .produit {
        max-width: 100px; /* R√©duire la largeur des produits sur mobile */
        margin: 0 auto; /* Centrer les produits */
    }

    .produit img {
        height: 200px; /* Augmenter la taille de l'image sur mobile */
    }

    .produit h3 {
        font-size: 1.1rem; /* R√©duire la taille des titres */
    }

    .produit p {
        font-size: 0.85rem; /* R√©duire la taille des descriptions */
    }

    .produit .prix {
        font-size: 1rem; /* R√©duire la taille du prix */
    }

    button.add-to-cart {
        padding: 0.6rem 1rem; /* Bouton plus petit sur mobile */
        font-size: 1rem;
    }
}

/* Tablette */
@media (max-width: 768px) {
    .produits-grid {
        grid-template-columns: repeat(2, 1fr); /* 2 produits par ligne */
        gap: 15px;
        padding: 1rem;
    }

    .produit img {
        height: 160px; /* Image un peu plus grande que sur mobile */
    }

    .produit h3 {
        font-size: 1.1rem;
    }

    .produit p {
        font-size: 0.9rem;
    }

    .produit .prix {
        font-size: 1.05rem;
    }

    button.add-to-cart {
        padding: 0.7rem 1.1rem;
    }

    header {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    nav ul {
        flex-direction: column;
        align-items: center;
    }

    nav ul li {
        margin: 0.5rem 0;
    }

    .header-icons {
        position: static;
        margin-top: 10px;
    }

    .header-content {
        flex-direction: column;
        align-items: center;
    }
}

/* Taille normale (√âcran moyen et plus grand) */
@media (min-width: 1024px) {
    .produits-grid {
        grid-template-columns: repeat(3, 1fr); /* 3 produits par ligne */
    }

    .produit img {
        height: 180px; /* Taille image pour les √©crans moyens */
    }

    .produit h3 {
        font-size: 1.2rem;
    }

    .produit p {
        font-size: 1rem;
    }

    .produit .prix {
        font-size: 1.1rem;
    }
}

/* Grand √©cran (bureau) */
@media (min-width: 1200px) {
    .produits-grid {
        grid-template-columns: repeat(4, 1fr); /* Quatre colonnes */
        gap: 2rem;
    }

    .produit img {
        height: 200px; /* Taille image plus grande sur les grands √©crans */
    }

    .produit h3 {
        font-size: 1.3rem;
    }

    .produit p {
        font-size: 1.1rem;
    }

    .produit .prix {
        font-size: 1.2rem;
    }

    button.add-to-cart {
        padding: 0.8rem 1.4rem;
        font-size: 1.2rem;
    }
}

    </style>
    <script type="module" defer>
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, getDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        // üî• Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA-NyzpyeUgA8ElI9-isZJNMBiCP76BYhs",
            authDomain: "fleurdepau-1ce7d.firebaseapp.com",
            projectId: "fleurdepau-1ce7d",
            storageBucket: "fleurdepau-1ce7d.appspot.com",
            messagingSenderId: "394738141831",
            appId: "1:394738141831:web:a0cd5b9d0227267b248622",
            measurementId: "G-D1J6X7BH9S"
        };
        
        // üî• Initialisation Firebase et Firestore
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // üìå Gestion de la d√©connexion
        document.addEventListener("DOMContentLoaded", () => {
            const logoutButton = document.getElementById("logout-icon");
            if (logoutButton) {
                logoutButton.addEventListener("click", async () => {
                    try {
                        await signOut(auth);
                        localStorage.removeItem("utilisateurConnecte");
                        window.location.href = "login.html"; // Rediriger apr√®s d√©connexion
                    } catch (error) {
                        console.error("Erreur lors de la d√©connexion:", error);
                    }
                });
            }
        });
        
        // üìå Gestion du panier
        let panier = JSON.parse(localStorage.getItem("panier")) || [];
        const panierCount = document.createElement("span");
        
        // S√©lecteur de l'ic√¥ne du panier et ajout du compteur
        const panierIcon = document.querySelector(".fa-shopping-cart");
        if (panierIcon) {
            panierIcon.style.position = "relative";
            panierIcon.appendChild(panierCount);
        }
        
        // Fonction pour mettre √† jour le panier
        function mettreAJourPanier() {
            panierCount.innerText = panier.length;
            localStorage.setItem("panier", JSON.stringify(panier));
        }
        
        // üìå Chargement des produits avec √©coute en temps r√©el
        function chargerProduitsBoutique() {
            const produitsContainer = document.getElementById("produits");
            if (!produitsContainer) return;
        
            const produitsRef = collection(db, "produits");
        
            onSnapshot(produitsRef, (snapshot) => {
                produitsContainer.innerHTML = ""; // Vider avant de recharger
                
                snapshot.forEach((produitDoc) => {  
                    const produit = produitDoc.data();  
                    const produitId = produitDoc.id;                  
                    
                    const produitElement = document.createElement("div");
                    produitElement.classList.add("produit");
            
                    const imageUrl = produit.imageUrl || "https://i.imgur.com/jOTXXdh.jpeg";
            
                    const couleursOptions = produit.couleurs
                        ? produit.couleurs
                            .map(c => `<option value="${c.couleur}" ${c.stock === 0 ? "disabled" : ""}>
                                    ${c.couleur} (${c.stock} en stock)
                                </option>`)
                            .join("")
                        : "<option value='default'>Aucune couleur</option>";
            
                    produitElement.innerHTML = 
                        `<img src="${imageUrl}" alt="${produit.nom}">
                        <h3>${produit.nom}</h3>
                        <p>${produit.description}</p>
                        <p class="prix">${produit.prix}‚Ç¨</p>
                        <select class="select-couleur">${couleursOptions}</select>
                        <button class="add-to-cart">Ajouter au panier</button>`;
            
                    const addToCartButton = produitElement.querySelector(".add-to-cart");
                    addToCartButton.addEventListener("click", async () => {
                        const couleurSelectionnee = produitElement.querySelector(".select-couleur").value;
                        const produitRef = doc(db, "produits", produitId);
                        const produitSnap = await getDoc(produitRef);
            
                        if (produitSnap.exists()) {
                            const produitData = produitSnap.data();
                            const couleurDispo = produitData.couleurs.find(c => c.couleur === couleurSelectionnee);
            
                            if (couleurDispo && couleurDispo.stock > 0) {
                                panier.push({
                                    id: produitId,
                                    nom: produit.nom,
                                    prix: produit.prix,
                                    imageUrl: imageUrl,
                                    couleur: couleurSelectionnee
                                });
                                mettreAJourPanier();
                            } else {
                                alert("Produit en rupture de stock !");
                            }
                        }
                    });
            
                    produitsContainer.appendChild(produitElement);
                });
            });
            
        }
        
        // üìå Mise √† jour du stock apr√®s paiement
        async function mettreAJourStockApresPaiement(panier) {
            for (const item of panier) {
                const produitRef = doc(db, "produits", item.id);
                const produitSnap = await getDoc(produitRef);
        
                if (produitSnap.exists()) {
                    const produitData = produitSnap.data();
                    const updatedCouleurs = produitData.couleurs.map(c => {
                        if (c.couleur === item.couleur) {
                            return { couleur: c.couleur, stock: Math.max(0, c.stock - 1) }; 
                        }
                        return c;
                    });
        
                    await updateDoc(produitRef, { couleurs: updatedCouleurs });
                }
            }
        
            localStorage.removeItem("panier"); // Vider le panier apr√®s mise √† jour
            alert("Stock mis √† jour et panier vid√© !");
            window.location.reload(); // Recharger pour actualiser les stocks affich√©s
        }
        
        // üî• S√©curiser l'ajout de l'√©v√©nement pour √©viter les erreurs si le bouton n'existe pas
        document.addEventListener("DOMContentLoaded", () => {
            const boutonPayer = document.getElementById("bouton-payer");
            if (boutonPayer) {
                boutonPayer.addEventListener("click", () => {
                    mettreAJourStockApresPaiement(JSON.parse(localStorage.getItem("panier")) || []);
                });
            }
        });
        
        // üìå Charger les produits et mettre √† jour le panier au chargement de la page
        window.addEventListener("load", () => {
            chargerProduitsBoutique();
            mettreAJourPanier();
        });

        document.addEventListener("DOMContentLoaded", () => {
            const modal = document.getElementById("imageModal");
            const modalImg = document.getElementById("modalImage");
            const closeModal = document.querySelector(".close");
        
            // D√©l√©gation d'√©v√©nement pour les images des produits
            document.getElementById("produits").addEventListener("click", (event) => {
                if (event.target.tagName === "IMG") {
                    modal.style.display = "flex";
                    modalImg.src = event.target.src;
                }
            });
        
            closeModal.addEventListener("click", () => {
                modal.style.display = "none";
            });
        
            modal.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.style.display = "none";
                }
            });
        });
        
        
        </script>
        
</head>
<body>
    <!-- En-t√™te -->
    <header>
        <div class="header-content">
            <div class="logo">Fleur de Pau</div>
            <nav>
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="boutique.html">Boutique</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-icons">
            <a href="mon-compte.html"><i class="fas fa-user"></i></a>
            <a href="login.html" id="logout-icon"><i class="fas fa-sign-out-alt"></i></a>
            <a href="panier.html"><i class="fas fa-shopping-cart"></i><span class="cart-count"></span></a>
        </div>
    </header>

    <!-- Produits -->
    <div class="produits-grid" id="produits">
        <!-- Les produits s'affichent ici -->
    </div>

    <div class="modal" id="imageModal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <footer>
        <p>¬© 2025 Fleur de Pau - Tous droits r√©serv√©s | 
            <a href="cgv.html">CGV</a> | 
            <a href="mentionsl√©gals.html">Mentions l√©gales</a> | 
            <a href="politiqueconfidentialit√©.html">Politique de confidentialit√©</a>
        </p>
    </footer>
    
</body>

</html>
